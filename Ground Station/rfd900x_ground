import time
from pymavlink import mavutil

# Configure the serial connection
serial_port = 'COM6'  # Replace with the appropriate COM port
baud_rate = 57600  # Set the baud rate according to your RFD900x configuration

# Create a MAVLink connection
mav = mavutil.mavlink_connection(serial_port, baud=baud_rate)

# Callback function to handle received messages
def handle_message(msg):
    if msg.get_type() == 'HEARTBEAT':
        print("Heartbeat received!")
        print("Message contents:", msg.to_dict())
    elif msg.get_type() == 'DEBUG':
        print("Debug message received!")
        print("Message contents:", msg.to_dict())
    elif msg.get_type() == 'NAMED_VALUE_FLOAT':
        print("Named value float received!")
        print("Message contents:", msg.to_dict())
    else:
        print("Unknown message type received:", msg.get_type())

# Main loop
while True:
    try:
        # Check if a message has been received
        msg = mav.recv_match(blocking=True)
        if msg:
            handle_message(msg)
        else:
            print("No message received.")

    except KeyboardInterrupt:
        print("Keyboard interrupt received. Exiting...")
        break

    except Exception as e:
        print(f"Error: {e}")

# Close the MAVLink connection when done
mav.close()